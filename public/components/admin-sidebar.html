<!-- Sidebar Component para Administradores - Tema Verde -->
<aside class="admin-sidebar" style="transform: translateX(-100%); transition: transform 0.3s ease;">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">M</div>
      <span class="sidebar-text">MAWI Super Admin</span>
    </div>
  </div>
  
  <nav class="sidebar-nav">
    <!-- Dashboard Principal -->
    <div class="sidebar-section">
      <h4 class="sidebar-section-title">Dashboard</h4>
      <a href="indexSAdmin.html" class="sidebar-item" data-page="super-admin">
        <span class="sidebar-icon">üîß</span>
        <span class="sidebar-text">Panel Super Admin</span>
      </a>
      <a href="dashboard.html" class="sidebar-item" data-page="dashboard">
        <span class="sidebar-icon">üè†</span>
        <span class="sidebar-text">Dashboard MAWI</span>
      </a>
    </div>

    <!-- Gesti√≥n de Usuarios -->
    <div class="sidebar-section">
      <h4 class="sidebar-section-title">Gesti√≥n de Usuarios</h4>
      <a href="SAaceptarusuarios.html" class="sidebar-item" data-page="usuarios-pendientes">
        <span class="sidebar-icon">‚è≥</span>
        <span class="sidebar-text">Usuarios Pendientes</span>
        <span class="sidebar-badge" id="pendingUsersCount">0</span>
      </a>
      <a href="AdmUpReguser.html" class="sidebar-item" data-page="gestion-usuarios">
        <span class="sidebar-icon">‚öôÔ∏è</span>
        <span class="sidebar-text">Gestionar Usuarios</span>
      </a>
      <a href="usuarios-rechazados.html" class="sidebar-item" data-page="usuarios-rechazados">
        <span class="sidebar-icon">‚ùå</span>
        <span class="sidebar-text">Usuarios Rechazados</span>
        <span class="sidebar-badge" id="rejectedUsersCount">0</span>
      </a>
    </div>
  </nav>
  
  <div class="sidebar-footer">
    <div class="sidebar-divider"></div>
    
    <a href="#" class="sidebar-logout" onclick="logout()">
      <span class="sidebar-icon">üö™</span>
      <span class="sidebar-text">Cerrar Sesi√≥n</span>
    </a>
  </div>
</aside>

<style>
/* ‚úÖ Estilos espec√≠ficos para sidebar de admin - TEMA VERDE */
.admin-sidebar {
  background: linear-gradient(180deg, #1a1f26 0%, #242b36 100%);
  width: 280px;
  border-right: 1px solid #374151;
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  z-index: 999;
  overflow-y: auto;
  /* ‚úÖ COLORES VERDES CONSISTENTES */
  --sidebar-primary: #48cc6c;
  --sidebar-primary-dark: #3da458;
  --sidebar-accent: #5dd673;
}

/* ‚úÖ ESTADOS DE LA SIDEBAR */
.admin-sidebar.sidebar-collapsed {
  transform: translateX(-100%);
}

.admin-sidebar.sidebar-expanded {
  transform: translateX(0);
}

.sidebar-header {
  padding: 1.5rem;
  border-bottom: 1px solid #374151;
  /* ‚úÖ HEADER VERDE */
  background: linear-gradient(135deg, var(--sidebar-primary) 0%, var(--sidebar-primary-dark) 100%);
}

.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-logo-icon {
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 1.125rem;
}

.sidebar-logo .sidebar-text {
  color: white;
  font-weight: 600;
  font-size: 1.125rem;
}

.sidebar-section {
  margin-bottom: 1.5rem;
}

.sidebar-section-title {
  padding: 0.75rem 1.5rem 0.5rem 1.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 0;
  border-bottom: 1px solid #374151;
  margin-bottom: 0.5rem;
}

.sidebar-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0.75rem 1.5rem;
  color: #d1d5db;
  text-decoration: none;
  transition: all 0.2s ease;
  border-left: 3px solid transparent;
  position: relative;
}

/* ‚úÖ HOVER VERDE */
.sidebar-item:hover {
  background: rgba(72, 204, 108, 0.1);
  color: var(--sidebar-primary);
  border-left-color: var(--sidebar-primary);
}

/* ‚úÖ ACTIVO VERDE */
.sidebar-item.active {
  background: rgba(72, 204, 108, 0.15);
  color: var(--sidebar-primary);
  border-left-color: var(--sidebar-primary);
  font-weight: 500;
}

.sidebar-icon {
  font-size: 1.125rem;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}

.sidebar-text {
  font-size: 0.875rem;
  flex: 1;
}

/* ‚úÖ BADGE VERDE */
.sidebar-badge {
  background: var(--sidebar-primary);
  color: white;
  font-size: 0.625rem;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
}

.sidebar-footer {
  margin-top: auto;
  padding: 1rem;
  border-top: 1px solid #374151;
}

.sidebar-divider {
  height: 1px;
  background: #374151;
  margin: 0.5rem 0;
}

.sidebar-logout {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0.5rem;
  color: #ef4444;
  text-decoration: none;
  font-size: 0.875rem;
  transition: all 0.2s ease;
  border-radius: 6px;
}

.sidebar-logout:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #dc2626;
  transform: translateX(2px);
}

/* ‚úÖ RESPONSIVE - M√ìVIL */
@media (max-width: 1023px) {
  .admin-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 999;
    transform: translateX(-100%);
  }
  
  .admin-sidebar.sidebar-expanded {
    transform: translateX(0);
  }
}
</style>

<script>
// Script para manejar la sidebar de administrador
(function() {
  'use strict';

  // ‚úÖ VARIABLES PARA FORZAR ESTADO CERRADO
  let sidebarInitialized = false;
  let forcedClosed = false;

  // Funci√≥n para marcar el elemento activo en la sidebar
  function setActiveMenuItem() {
    const currentPage = document.body.getAttribute('data-page');
    if (!currentPage) return;

    // Remover clase active de todos los elementos
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.classList.remove('active');
    });

    // Agregar clase active al elemento correspondiente
    const activeItem = document.querySelector(`.sidebar-item[data-page="${currentPage}"]`);
    if (activeItem) {
      activeItem.classList.add('active');
    }
  }

  // Cargar informaci√≥n del usuario
  function loadUserInfo() {
    const token = localStorage.getItem('token');
    if (token) {
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        
        // Actualizar avatar
        const userInitials = document.getElementById('userInitials');
        const sidebarUsername = document.getElementById('sidebarUsername');
        const sidebarUserRole = document.getElementById('sidebarUserRole');
        
        if (userInitials && payload.nombre) {
          userInitials.textContent = payload.nombre.substring(0, 2).toUpperCase();
        }
        
        if (sidebarUsername && payload.nombre) {
          sidebarUsername.textContent = payload.nombre;
        }
        
        if (sidebarUserRole && payload.rol) {
          const roles = {
            1: 'Usuario',
            2: 'Biomonitor', 
            3: 'Administrador',
            4: 'Super Administrador'
          };
          sidebarUserRole.textContent = roles[payload.rol] || 'Usuario';
        }
        
      } catch (error) {
        console.error('Error decodificando token:', error);
      }
    }
  }

  // Cargar contador de usuarios pendientes
  async function loadPendingUsersCount() {
    try {
      const token = localStorage.getItem('token');
      if (!token) return;

      const response = await fetch('/Consultas/api/listpendientes', {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        const data = await response.json();
        const count = data.data ? data.data.length : 0;
        
        const badge = document.getElementById('pendingUsersCount');
        if (badge) {
          badge.textContent = count;
          badge.style.display = count > 0 ? 'block' : 'none';
        }
      }
    } catch (error) {
      console.error('Error cargando usuarios pendientes:', error);
    }
  }

  // Cargar contador de usuarios rechazados
  async function loadRejectedUsersCount() {
    try {
      const token = localStorage.getItem('token');
      if (!token) return;

      const response = await fetch('/Consultas/api/getRechazadosCount', {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        const data = await response.json();
        const count = data.count || 0;
        
        const badge = document.getElementById('rejectedUsersCount');
        if (badge) {
          badge.textContent = count;
          badge.style.display = count > 0 ? 'block' : 'none';
        }
      }
    } catch (error) {
      console.error('Error cargando usuarios rechazados:', error);
    }
  }

  // ‚úÖ FUNCI√ìN PARA FORZAR SIDEBAR CERRADA
  function forceSidebarClosed() {
    const sidebar = document.querySelector('.admin-sidebar');
    if (sidebar && !forcedClosed) {
      // Forzar estado colapsado
      sidebar.classList.add('sidebar-collapsed');
      sidebar.classList.remove('sidebar-expanded');
      
      // Agregar estilos inline para asegurar que se mantenga cerrada
      sidebar.style.transform = 'translateX(-100%)';
      
      // Actualizar localStorage
      localStorage.setItem('mawi_sidebar_state', 'collapsed');
      
      // Marcar como forzada
      forcedClosed = true;
      
      console.log('‚úÖ Sidebar FORZADA como cerrada');
    }
  }

  // ‚úÖ FUNCI√ìN PARA INTERCEPTAR CUALQUIER INTENTO DE ABRIR LA SIDEBAR
  function interceptSidebarOpen() {
    // Interceptar eventos que puedan abrir la sidebar
    document.addEventListener('sidebarOpened', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('üö´ Intento de abrir sidebar interceptado');
      forceSidebarClosed();
    });

    // Observar cambios en las clases de la sidebar
    const sidebar = document.querySelector('.admin-sidebar');
    if (sidebar) {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            const target = mutation.target;
            if (target.classList.contains('sidebar-expanded') && !sidebarInitialized) {
              console.log('üö´ Sidebar se intent√≥ abrir autom√°ticamente, forzando cierre');
              forceSidebarClosed();
            }
          }
        });
      });

      observer.observe(sidebar, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
  }

  // ‚úÖ INICIALIZACI√ìN INMEDIATA
  function initializeSidebar() {
    console.log('üîß Inicializando sidebar cerrada...');
    
    // Forzar cerrada inmediatamente
    forceSidebarClosed();
    
    // Interceptar intentos de apertura
    interceptSidebarOpen();
    
    // Cargar datos
    setActiveMenuItem();
    loadUserInfo();
    loadPendingUsersCount();
    loadRejectedUsersCount();
    
    // Marcar como inicializada despu√©s de un delay
    setTimeout(() => {
      sidebarInitialized = true;
      console.log('‚úÖ Sidebar inicializada completamente');
    }, 2000);
  }

  // ‚úÖ EJECUTAR INMEDIATAMENTE CUANDO SE CARGA EL SCRIPT
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeSidebar);
  } else {
    initializeSidebar();
  }

  // ‚úÖ TAMBI√âN EJECUTAR EN EVENTOS PERSONALIZADOS
  document.addEventListener('sidebarLoaded', function() {
    console.log('üì¢ Evento sidebarLoaded recibido, forzando cierre');
    setTimeout(() => {
      forceSidebarClosed();
      interceptSidebarOpen();
    }, 100);
  });

  // ‚úÖ FORZAR CIERRE CADA 500ms DURANTE LOS PRIMEROS 5 SEGUNDOS
  let attempts = 0;
  const maxAttempts = 10;
  const forceCloseInterval = setInterval(() => {
    attempts++;
    forceSidebarClosed();
    
    if (attempts >= maxAttempts) {
      clearInterval(forceCloseInterval);
      console.log('‚úÖ Finalizado forzado de cierre de sidebar');
    }
  }, 500);

})();
</script>